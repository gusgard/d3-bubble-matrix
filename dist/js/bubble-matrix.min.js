"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),BubbleMatrix=function(){function t(e){if(_classCallCheck(this,t),!e.root&&!e.selector)throw"Missing root or id";this.selection=e.root||d3.select(e.selector),this.onClick=e.onClick||!1,this.hideLeftTitle=e.hideLeftTitle||!1,this.hideRightTitle=e.hideRightTitle||!1,this.hideTopTitle=e.hideTopTitle||!1,this.hideBottomTitle=e.hideBottomTitle||!1,this.duration=e.duration||2e3,this.HORIZONTAL_PADDING=.5,this.VERTICAL_PADDING=.5,this.MAX_RADIUS=e.maxRadius||26,this.MAX_COLORS=e.maxColors||9,this.PADDING=e.padding||{top:20,right:0,bottom:20,left:10},this.RECT_SIZE=2*this.MAX_RADIUS,this.COLOR_DOMAIN=e.reverseColor?[1,0]:[0,1],this.CLASS=e.classNames||{bubbleMatrix:"bubble-matrix",leftRows:"left-rows",rightRows:"right-rows",horizontalLines:"horizontal-lines",verticalLines:"vertical-lines",row:"row",column:"column",topColumns:"top-columns",bottomColumns:"bottom-columns",rects:"rects",bubbles:"bubbles",color:"bubble-color-"};var i=this.selection.node().parentNode.clientWidth,s=this.selection.node().parentNode.clientHeight,n=parseInt(e.width,10)||i,r=parseInt(e.height,10)||s;this.container=this.selection.append("svg").attr("class",this.CLASS.bubbleMatrix).attr("width",n).attr("height",r),this.width=n-this.PADDING.right-this.PADDING.left,this.height=r-this.PADDING.bottom-this.PADDING.top,this.events={},this.hideTooltip=e.hideTooltip||!1,this.hideTooltip||(this.tooltip=e.tooltip||d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){return"Value: "+t}),this.container.call(this.tooltip),this.events.mouseover=this.tooltip.show,this.events.mouseout=this.tooltip.hide),this.onClick&&(this.events.click=this.onClick.bind(this))}return _createClass(t,[{key:"init",value:function(){return this.columns=this.data.columns,this.rows=this.data.rows,this.scale={},this.scale.y=d3.scale.ordinal().domain(d3.range(0,this.rows.length)).rangePoints([0,this.height],this.VERTICAL_PADDING),this.scale.color=d3.scale.quantize().domain(this.COLOR_DOMAIN).range(d3.range(1,this.MAX_COLORS+1)),this.scale.radius=d3.scale.sqrt().range([0,this.MAX_RADIUS]),this}},{key:"initScaleX",value:function(){var t=0;if(!this.hideLeftTitle){var e=d3.select("."+this.CLASS.leftRows).node().getBBox().width;t=e+this.PADDING.left}var i=this.hideRightTitle?0:d3.select("."+this.CLASS.rightRows).node().getBBox().width,s=this.width-i+this.PADDING.left;return this.scale.x=d3.scale.ordinal().domain(d3.range(0,this.columns.length)).rangePoints([t,s],this.HORIZONTAL_PADDING),this}},{key:"draw",value:function(t){if(!t)throw"Missing data";this.data=t,this.init().drawLeftRows().drawRightRows().initScaleX().drawBackground().drawTopColumns().drawBottomColumns().drawRects().drawBubbles()}},{key:"drawBackground",value:function(){var t=this;return this.container.append("g").attr("class",this.CLASS.horizontalLines).selectAll("line").data(this.rows).enter().append("line").attr("x1",this.scale.x(0)).attr("y1",function(e,i){return t.scale.y(i)+t.PADDING.top}).attr("x2",this.scale.x(0)).attr("y2",function(e,i){return t.scale.y(i)+t.PADDING.top}).transition().duration(this.duration/2).attr("x2",this.scale.x(this.columns.length-1)),this.container.append("g").attr("class",this.CLASS.verticalLines).selectAll("line").data(this.columns).enter().append("line").attr("x1",function(e,i){return t.scale.x(i)}).attr("y1",function(e,i){return t.scale.y(0)}).attr("x2",function(e,i){return t.scale.x(i)}).attr("y2",function(e,i){return t.scale.y(0)}).transition().duration(this.duration/2).attr("y2",function(e,i){return t.scale.y(t.rows.length-1)}),this}},{key:"drawLeftRows",value:function(){var t=this;return this.hideLeftTitle?this:(this.container.append("g").attr("class",this.CLASS.leftRows).selectAll("text").data(this.rows).enter().append("text").attr("class",this.CLASS.row).attr("x",this.PADDING.left).attr("y",function(e,i){return t.scale.y(i)+t.PADDING.top}).attr("dy",5).text(function(t){return t.name}),this)}},{key:"drawRightRows",value:function(){var t=this;if(this.hideRightTitle)return this;this.hideLeftTitle?0:d3.select("."+this.CLASS.leftRows).node().getBBox().width;return this.container.append("g").attr("class",this.CLASS.rightRows).selectAll("text").data(this.rows).enter().append("text").attr("class",this.CLASS.row).attr("x",function(e,i){return t.width+t.PADDING.right+t.PADDING.left}).attr("y",function(e,i){return t.scale.y(i)+t.PADDING.top}).attr("dy",5).text(function(t){return t.name}),this}},{key:"drawTopColumns",value:function(){var t=this;return this.hideTopTitle?this:(this.container.append("g").attr("class",this.CLASS.topColumns).selectAll("text").data(this.columns).enter().append("text").attr("class",this.CLASS.column).attr("x",function(e,i){return t.scale.x(i)}).attr("y",this.PADDING.top).text(function(t){return t}),this)}},{key:"drawBottomColumns",value:function(){var t=this;return this.hideBottomTitle?this:(this.container.append("g").attr("class",this.CLASS.bottomColumns).selectAll("text").data(this.columns).enter().append("text").attr("class",this.CLASS.column).attr("x",function(e,i){return t.scale.x(i)}).attr("y",this.height+this.PADDING.bottom+this.PADDING.top).text(function(t){return t}),this)}},{key:"drawRects",value:function(){for(var t=this,e=this.container.append("g").attr("class",this.CLASS.rects),i=function(i){var s=t.rows[i],n=e.append("g").attr("class",t.CLASS.row).selectAll("rect").data(s.values).enter();n.append("rect").attr("y",function(e){return t.scale.y(i)+t.PADDING.top-t.RECT_SIZE/2}).attr("x",function(e,i){return t.scale.x(i)-t.RECT_SIZE/2}).attr("width",t.RECT_SIZE).attr("height",t.RECT_SIZE).on(t.events)},s=0;s<this.rows.length;s++)i(s);return this}},{key:"drawBubbles",value:function(){for(var t=this,e=this,i=this.container.append("g").attr("class",this.CLASS.bubbles),s=function(s){var n=t.rows[s],r=i.append("g").attr("class",t.CLASS.row).selectAll("circle").data(n.values).enter();r.append("circle").attr("class",function(e){return t.CLASS.color+t.scale.color(e)}).attr("cy",function(){return t.scale.y(s)+t.PADDING.top}).attr("cx",function(e,i){return t.scale.x(i)}).attr("r",0).on(t.events).on("mouseenter",function(){d3.select(this).transition().attr("r",function(t){return 1.2*e.scale.radius(t)})}).on("mouseleave",function(){d3.select(this).transition().attr("r",function(t){return e.scale.radius(t)})}).transition().duration(t.duration).attr("r",function(e){return t.scale.radius(e)})},n=0;n<this.rows.length;n++)s(n);return this}}]),t}();